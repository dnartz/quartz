var config,currentTheme,getCategory,meta,post,url;url=require("url"),post=require("./models/post"),getCategory=require("./models/archive"),meta=JSON.stringify(require("./dao/meta")),config=require("./data/config/config"),currentTheme="tanzaku",setInterval(function(){return currentTheme=config.themesList[parseInt(Math.random()*(config.themesList.length-1))]},36e5),exports.index=function(e,t){return e.url=url.parse(e.url,!0).pathname,"/public"!==e.url.substr(0,7)?t.sendfile("public/themes/"+currentTheme+"/index.html"):t.sendfile(e.url.substring(1),null,function(e){return e?t.sendfile("public/themes/"+currentTheme+"/index.html"):void 0})},exports.meta=function(e,t){return t.send(meta)},exports.post=function(e,t){var r;return r=post.getAllById(e.param("id")),r===!1?t.status(404).send():t.send(JSON.stringify(r[0]))},exports.multiPost=function(e,t){var r,s,i,n;return r=url.parse(e.url,!0).query,r.moreTag="true"===r.moreTag?!0:!1,r.offset=parseInt(r.offset,10),r.limit=parseInt(r.limit,10),s=post.getPropertiesByOrder(function(){n=[];for(var e=i=r.offset,t=r.offset+r.limit;t>=i?t>e:e>t;t>=i?e++:e--)n.push(e);return n}.apply(this),r.get,r.moreTag),t.send(s===!1?[]:JSON.stringify(s))},exports.archive=function(e,t){return t.send(JSON.stringify(getCategory(e.param("get"))))},exports.getPostsByCategories=function(e,t){var r,s;return r=url.parse(e.url,!0).query,r.offset=parseInt(r.offset,10),r.limit=parseInt(r.limit,10),r.moreTag="true"===r.moreTag?!0:!1,r.limit>config.maxPostPerRequest?t.status(404).send():(s=post.getPropertiesByCategory(e.param("category"),r.get,r.offset,r.limit,r.moreTag),t.send(s===!1?[]:JSON.stringify(s)))},exports.getPostsBySingleTag=function(e,t){var r,s;return r=url.parse(e.url,!0).query,r.offset=parseInt(r.offset,10),r.limit=parseInt(r.limit,10),r.moreTag="true"===r.moreTag?!0:!1,s=post.getPropertiesByTag(e.param("tag"),r.get,r.offset,r.limit,r.moreTag),t.send(s===!1?[]:JSON.stringify(s))},exports.getFavicon=function(e,t){return t.sendfile("public/favicon.ico")};