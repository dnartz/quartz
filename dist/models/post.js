var arrayIndex2PostId,categories,categoriesIndex,category,cutContent,fetchPropertiesById,idsAndPropretiesCheck,idsCheck,isEmptyArray,post,postFileds,postIds,posts,postsIdIndex,propertiesCheck,tagsIndex,tagsList,that,_,_i,_j,_len,_len1,__slice=[].slice;for(posts=require(__dirname+"/../dao/post").posts,postIds=posts.map(function(e){return parseInt(e.id,10)}),postsIdIndex=require(__dirname+"/../dao/post").postsIdIndex,tagsIndex=require(__dirname+"/../dao/post").tagsIndex,tagsList=require(__dirname+"/../dao/post").tags,postFileds=require(__dirname+"/../data/config/config").postFileds,categories=require(__dirname+"/../dao/category"),categoriesIndex={},_i=0,_len=categories.length;_len>_i;_i++)category=categories[_i],categoriesIndex[category]=[];for(_j=0,_len1=posts.length;_len1>_j;_j++)post=posts[_j],categoriesIndex[post.category].push(post);cutContent=require(__dirname+"/../utility/post").cutContent,_=require("underscore")._,isEmptyArray=function(e){return e=_.without(e,!1),_.isEmpty(e)?!1:e},arrayIndex2PostId=function(e){return _.isArray(e)!==!0&&(e=[e]),isEmptyArray(e.map(function(e){return _.isObject(posts[e])!==!0?!1:parseInt(posts[e].id,10)}))},propertiesCheck=function(e){return _.isArray(e)!==!0&&(e=[e]),0===_.intersection(e,postFileds).length?!1:e},idsCheck=function(e){return e===!1?!1:(_.isArray(e)!==!0&&(e=[e]),e=e.map(function(e){return parseInt(e,10)}))},idsAndPropretiesCheck=function(e){return function(){var t,r;return t=1<=arguments.length?__slice.call(arguments,0):[],(r=idsCheck(t[0]))===!1?!1:(t[1]=propertiesCheck(t[1]),0===_.intersection(r,postIds).length||t[1]===!1?!1:null!=e?e.apply(that,[r].concat(t.slice(1))):void 0)}},fetchPropertiesById=function(e,t,r){var n,s,o,i;if(_.isUndefined(postsIdIndex[e]))return!1;for(s={},o=0,i=t.length;i>o;o++)n=t[o],s[n]=postsIdIndex[e][n],"content"===n&&(s.content=cutContent(s.content,r),s.moreTag=!(s.content===postsIdIndex[e].content));return s},module.exports={getPropertiesById:idsAndPropretiesCheck(function(e,t,r){return null==r&&(r=!1),isEmptyArray(e.map(function(e){return fetchPropertiesById(e,t,r)}))}),getPropertiesByCategory:function(e,t,r,n,s){var o,i,p,d,a,u,l,c;if(null==r&&(r=null),null==n&&(n=null),null==s&&(s=!1),(t=propertiesCheck(t))===!1)return!1;if(_.isArray(e)!==!0&&(e=[e]),0===(e=_.intersection(e,categories)).length)return!1;if(1===e.length&&(0>r||1>n))return!1;for(i=[],d=0,u=e.length;u>d;d++)p=e[d],i.push({name:p,posts:[]});for(a=0,l=i.length;l>a;a++){p=i[a],c=categoriesIndex[p.name];for(o in c)if(post=c[o],(1===e.length&&r>=0&&n>0&&o>=r||e.length>1)&&(p.posts.push(fetchPropertiesById(post.id,t,s)),1===e.length&&p.posts.length>=n))break}return _.isEmpty(i)?!1:(1===e.length&&(i=i[0].posts),i)},getPropertiesByTag:function(e,t,r,n,s){var o,i,p,d,a,u,l,c;if(null==r&&(r=null),null==n&&(n=null),null==s&&(s=!1),_.isArray(e)!==!0&&(e=[e]),e=_.intersection(e,tagsList),0===e.length)return!1;if((t=propertiesCheck(t))===!1)return!1;for(i={},d=0,u=e.length;u>d;d++)for(p=e[d],i[p]=[],c=tagsIndex[p],o=a=0,l=c.length;l>a&&(post=c[o],!((1===e.length&&r>=0&&n>0&&i[p].length<n&&o>=r||e.length>1)&&(i[p].push(this.getPropertiesById(post.id,t,s)[0]),1===e.length&&r>=0&&n>0&&i[p].length===n)));o=++a);return 1===e.length&&(i=i[e[0]]),i},getAllById:function(e,t){return null==t&&(t=!1),(e=idsCheck(e))===!1?!1:isEmptyArray(e.map(function(e){var r;return _.isObject(postsIdIndex[e])!==!0?!1:(r=_.extend({moreTag:t},postsIdIndex[e]),t&&(r.content=cutContent(r.content,t)),r)}))},getPropertiesByOrder:function(e,t,r){return null==r&&(r=!1),this.getPropertiesById(arrayIndex2PostId(e),t,r)},getAllByOrder:function(e,t){return null==t&&(t=!1),this.getAllById(arrayIndex2PostId(e),t)}},that=module.exports;