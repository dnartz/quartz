angular.module("quartz.theme",["quartz.config","ngRoute","infinite-scroll"]).config(["$routeProvider","routeUrls","maxPostsPerReq",function($routeProvider,routeUrls,maxPostsPerReq){return $routeProvider.when(routeUrls.HomePage,{controller:"MultiPostCtrl",resolve:{posts:function(MultiPostLoader){return MultiPostLoader({type:"Post",offset:0,limit:maxPostsPerReq,get:["id","tags","title","content","postDate","category"],moreTag:!0})},type:function(){return"Post"}},templateUrl:"multipost.html"}).when(routeUrls.Category,{controller:"MultiPostCtrl",resolve:{posts:function(MultiPostLoader){return MultiPostLoader({type:"Category",offset:0,limit:maxPostsPerReq,get:["id","tags","title","content","postDate"],moreTag:!0})},type:function(){return"Category"}},templateUrl:"multipost.html"}).when(routeUrls.Tag,{controller:"MultiPostCtrl",resolve:{posts:function(MultiPostLoader){return MultiPostLoader({type:"Tag",offset:0,limit:maxPostsPerReq,get:["id","tags","title","content","postDate","category"],moreTag:!0})},type:function(){return"Tag"}},templateUrl:"multipost.html"}).when(routeUrls.Single,{controller:"PostCtrl",resolve:{post:function(PostLoader){return PostLoader()}},templateUrl:"/public/themes/tanzaku/post.html"}).otherwise({redirectTo:"/"})}]).service("redrawGrid",["$rootScope",function($rootScope){var COL_GAP_WIDTH,COL_WIDTH,MAX_COL_SIZE,arrWidth,lastPostCount,setGrid,x;return lastPostCount=0,setGrid=function(){return $("#grid-wrapper").vgrid({easeing:"easeOutQuint",time:500,delay:0,selRefGrid:"#grid-wrapper div.x1",selFitWidth:["#container","#footer"],gridDefWidth:325,forceAnim:!0})},MAX_COL_SIZE=2,COL_WIDTH=395,COL_GAP_WIDTH=35,arrWidth=function(){var _i,_results;for(_results=[],x=_i=0;MAX_COL_SIZE>=0?MAX_COL_SIZE>=_i:_i>=MAX_COL_SIZE;x=MAX_COL_SIZE>=0?++_i:--_i)_results.push(COL_WIDTH*(x+1)+COL_GAP_WIDTH*x);return _results}(),function(isRouteChange){var anim_msec,colClass,height,i,img,isSinglePost,newHeight,newWidth,postDiv,postDivs,width,_i,_j,_len,_ref;if(null==isRouteChange&&(isRouteChange=!1),isSinglePost=$rootScope.meta.isSinglePost,isSinglePost!==!0&&isRouteChange!==!0&&(null!=(_ref=$rootScope.posts)?_ref.length:void 0)===lastPostCount)return null;if(isSinglePost!==!0)for(postDivs=$("#grid-wrapper>div:not(:has(>.grid-image))"),_i=0,_len=postDivs.length;_len>_i;_i++)if(postDiv=postDivs[_i],img=$(postDiv).find("img").first()[0],null!=img){for(width=img.clientWidth,height=img.clientHeight,i=_j=0;MAX_COL_SIZE>=0?MAX_COL_SIZE>=_j:_j>=MAX_COL_SIZE;i=MAX_COL_SIZE>=0?++_j:--_j)if(i>=MAX_COL_SIZE-1||width<arrWidth[i+1]){newWidth=arrWidth[i],colClass="x"+(i+1);break}newHeight=parseInt(newWidth*(height/width),10),$("#"+$(postDiv).attr("id")+">.post-title").after('<div class="grid-image"><a href="'+$("#"+$(postDiv).attr("id")+">.post-title>a").attr("href")+('" title="'+$("#"+$(postDiv).attr("id")+">.post-title").text()+'"><img src="'+$(img).attr("src")+'"></a>')),$(img).remove()}return isSinglePost&&$("#grid-wrapper").css("display","none"),$("#grid-wrapper").css("paddingTop","0px"),setTimeout(setGrid,10),isSinglePost&&(anim_msec=$("#single-wrapper").height(),1e3>anim_msec&&(anim_msec=1e3),anim_msec>3e3&&(anim_msec=3e3),$("#single-wrapper").css("paddingTop","0px").hide().slideDown(anim_msec)),"hidden"===$("#header").css("visibility")&&$("#header").hide().css("visibility","visible").fadeIn(500),setTimeout(function(){return $rootScope.LoadMoreLock=!1},1500),isSinglePost!==!0?lastPostCount=$rootScope.posts.length:void 0}}]).controller("MultiPostCtrl",["$rootScope","Post","MultiPostLoader","redrawGrid","maxPostsPerReq","type",function($rootScope,Post,MultiPostLoader,redrawGrid,maxPostsPerReq,type){return setTimeout(function(){return redrawGrid(!0)},50),$rootScope.LoadMore=function(){return $rootScope.LoadMoreLock!==!0&&($rootScope.LoadMoreLock=!0,MultiPostLoader({type:type,offset:$rootScope.lastPostOrd,limit:maxPostsPerReq,get:["id","tags","title","content","postDate"],moreTag:!0}).then(redrawGrid)),$rootScope.allPostsLoaded?$rootScope.LoadMore=function(){}:void 0}}]).controller("PostCtrl",["redrawGrid",function(redrawGrid){return redrawGrid(!0)}]);